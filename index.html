<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CWL Leaderboard - CHECKMATES</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "Inter", sans-serif;
      margin: 0;
      padding: 20px;
      background: radial-gradient(circle at top, #2b1a08 0%, #120700 100%);
      min-height: 100vh;
      color:#f9d37a;
    }

    .top-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    h2.title {
      color:#ffcc33;
      margin:0;
      text-shadow:0 0 15px rgba(255,204,51,0.8);
      animation:titleGlow 3s infinite alternate;
      font-size:20px;
    }

    @keyframes titleGlow {
      from { text-shadow: 0 0 8px #ffb300; }
      to { text-shadow: 0 0 25px #ffe66d; }
    }

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
    }

    .arrow-btn{
      background:rgba(0,0,0,0.45);
      border:1px solid rgba(255,215,0,0.12);
      color:#fffbe0;
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 2px 10px rgba(0,0,0,0.4);
    }

    .month-select{
      background:rgba(0,0,0,0.35);
      color:#f9d37a;
      border:1px solid rgba(255,215,0,0.12);
      padding:8px 10px;
      border-radius:10px;
      font-weight:600;
    }

    .subtitle{
      width:100%;
      text-align:center;
      color:#ffe28a;
      font-size:16px;
      margin:6px 0 18px;
      letter-spacing:1px;
    }

    .table-container{
      overflow-x:auto;
      width:100%;
      background:rgba(0,0,0,0.55);
      border-radius:16px;
      box-shadow:0 0 25px rgba(255,204,51,0.25);
      padding:10px;
      backdrop-filter:blur(6px);
      margin-bottom:30px;
      animation:fadeIn 0.7s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity:0; transform:translateY(10px); }
      to { opacity:1; transform:translateY(0); }
    }

    table{
      border-collapse:collapse;
      width:100%;
      border-radius:12px;
      overflow:hidden;
      background:linear-gradient(135deg,#3a250f,#6b3f11);
      color:#f9d37a;
      box-shadow:0 0 20px rgba(0,0,0,0.3);
      font-size:15px;
    }

    th{
      background:linear-gradient(90deg,#b8860b,#ffb300);
      color:#fffbe0;
      padding:10px;
      text-align:left;
      font-weight:600;
      position:sticky;
      top:0;
    }

    td{
      border-bottom:1px solid rgba(255,255,255,0.06);
      padding:8px;
    }

    tr:nth-child(even) td{
      background:rgba(255,255,255,0.02);
    }

    tr:hover td{
      background:rgba(255,204,51,0.06);
      color:#fff8e1;
    }

    .error-box{
      background:rgba(0,0,0,0.6);
      border:1px solid rgba(255,50,50,0.12);
      padding:12px;
      border-radius:8px;
      color:#ffd7d7;
      margin-bottom:10px;
    }

    /* ========================= */
    /* üî• Clash of Clans Footer */
    /* ========================= */

    .coc-footer{
      position:relative;
      margin-top:80px;
      height:260px;
      overflow:hidden;
      border-top:2px solid rgba(255,180,0,0.6);
      box-shadow:0 -10px 30px rgba(255,100,0,0.4);
    }

    .coc-bg{
      position:absolute;
      inset:0;
      background:
        linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.3)),
        url("https://i.ibb.co/0jsJm7J/coc-battle-bg.jpg");
      background-size:cover;
      background-position:center;
      filter:blur(1px);
    }

    .coc-footer-content{
      position:relative;
      z-index:2;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:space-around;
      padding:10px;
    }

    .coc-logo-left{
      height:85px;
      filter:drop-shadow(0 0 12px orange);
    }

    .clan-logo-center{
      height:130px;
      filter:drop-shadow(0 0 20px rgba(255,165,0,0.9));
      animation:flamePulse 2s infinite alternate;
      border-radius:18px;
    }

    .clan-name{
      font-size:32px;
      font-weight:700;
      color:#ffcc00;
      text-shadow:
        0 0 15px rgba(255,165,0,0.8),
        0 0 30px rgba(255,100,0,0.7);
      letter-spacing:2px;
    }

    .footer-text{
      position:absolute;
      bottom:10px;
      width:100%;
      text-align:center;
      font-size:14px;
      color:#ffd27f;
      z-index:2;
    }

    @keyframes flamePulse{
      from{
        transform:scale(1);
        filter:drop-shadow(0 0 10px orange);
      }
      to{
        transform:scale(1.06);
        filter:drop-shadow(0 0 24px red);
      }
    }

    @media(max-width:600px){
      .coc-logo-left{height:60px;}
      .clan-logo-center{height:90px;}
      .clan-name{font-size:22px;}
      table{font-size:13px;}
    }
  </style>
</head>

<body>

  <div class="top-row">
    <h2 class="title" id="pageTitle">üèÜ CWL | Leaderboard - </h2>

    <div class="controls">
      <button class="arrow-btn" id="prevBtn">‚óÄ</button>
      <select id="monthSelect" class="month-select"></select>
      <button class="arrow-btn" id="nextBtn">‚ñ∂</button>
    </div>
  </div>

  <div class="subtitle" id="subtitle">Season</div>

  <div id="errorArea"></div>

  <div class="table-container">
    <table id="dataTable">
      <tr><td>Loading...</td></tr>
    </table>
  </div>

  <h2 class="title">üèÅ Final Point Table</h2>
  <div class="table-container">
    <table id="finalTable">
      <tr><td>Loading...</td></tr>
    </table>
  </div>

  <script>
    const spreadsheetId = "1AIy-9I3dWadyYZwvplNzU_onua60uWV_LG646JbY9yU";

    const tables = {
      "November": { label: "November Season", gid: 0 },
      "December": { label: "December Season", gid: 1347643855 }
    };

    const defaultMonth = "December";
    const REFRESH_INTERVAL = 30000;

    function buildCsvUrl(gid){
      return `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=csv&gid=${gid}`;
    }

    function parseCsvLine(line){
      const matches = line.match(/("([^"]*(?:""[^"]*)*)"|[^,]*)(,|$)/g);
      if(!matches) return[];
      return matches.map(m=>{
        m = m.endsWith(',') ? m.slice(0,-1) : m;
        m = m.replace(/^"(.*)"$/, '$1').replace(/""/g,'"');
        return m.trim();
      });
    }

    const monthKeys = Object.keys(tables);
    const monthSelect = document.getElementById("monthSelect");
    const pageTitle = document.getElementById("pageTitle");
    const subtitle = document.getElementById("subtitle");
    const dataTableEl = document.getElementById("dataTable");
    const finalTableEl = document.getElementById("finalTable");
    const errorArea = document.getElementById("errorArea");

    monthKeys.forEach(m=>{
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = m;
      monthSelect.appendChild(opt);
    });

    let currentIndex = Math.max(0, monthKeys.indexOf(defaultMonth));
    monthSelect.value = monthKeys[currentIndex];

    function showLoading(){
      dataTableEl.innerHTML = "<tr><td>Loading...</td></tr>";
      finalTableEl.innerHTML = "<tr><td>Loading...</td></tr>";
      errorArea.innerHTML = "";
    }

    async function loadMonth(key){
      const m = tables[key];
      const url = buildCsvUrl(m.gid);
      pageTitle.textContent = "üèÜ CWL | Leaderboard - " + key;
      subtitle.textContent = m.label;
      showLoading();

      try{
        const res = await fetch(url);
        if(!res.ok) throw new Error("Fetch failed: " + res.status);
        const text = await res.text();
        const lines = text.split(/\r?\n/).filter(l=>l.trim()!=="");
        const rows = lines.map(parseCsvLine);
        const headers = rows[0];
        const dataRows = rows.slice(1);

        let html = "<tr>" + headers.map(h=>`<th>${h}</th>`).join("") + "</tr>";
        dataRows.forEach(r=>{
          html += "<tr>" + r.map(c=>`<td>${c}</td>`).join("") + "</tr>";
        });
        dataTableEl.innerHTML = html;

        const rankIndex = headers.findIndex(h=>h.toLowerCase()==="rank");
        const playerIndex = headers.findIndex(h=>h.toLowerCase().includes("player"));
        const pointsIndex = headers.findIndex(h=>h.toLowerCase().includes("total"));
        const destructionIndex = headers.findIndex(h=>h.toLowerCase().includes("destruction"));

        let finalHtml = "<tr><th>Player</th><th>Total Points</th><th>Destruction</th><th>Rank</th></tr>";
        dataRows.forEach(r=>{
          finalHtml += `
            <tr>
              <td>${r[playerIndex]||""}</td>
              <td>${r[pointsIndex]||""}</td>
              <td>${r[destructionIndex]||""}</td>
              <td>${r[rankIndex]||""}</td>
            </tr>
          `;
        });
        finalTableEl.innerHTML = finalHtml;

      }catch(e){
        errorArea.innerHTML = "<div class='error-box'>‚ùå Sheet load failed</div>";
        dataTableEl.innerHTML = "<tr><td>Error</td></tr>";
        finalTableEl.innerHTML = "<tr><td>Error</td></tr>";
      }
    }

    document.getElementById("prevBtn").onclick = ()=> {
      currentIndex = (currentIndex-1+monthKeys.length)%monthKeys.length;
      monthSelect.value = monthKeys[currentIndex];
      loadMonth(monthKeys[currentIndex]);
    };

    document.getElementById("nextBtn").onclick = ()=> {
      currentIndex = (currentIndex+1)%monthKeys.length;
      monthSelect.value = monthKeys[currentIndex];
      loadMonth(monthKeys[currentIndex]);
    };

    monthSelect.onchange = ()=>{
      currentIndex = monthKeys.indexOf(monthSelect.value);
      loadMonth(monthKeys[currentIndex]);
    };

    loadMonth(monthKeys[currentIndex]);
    setInterval(()=>loadMonth(monthKeys[currentIndex]),REFRESH_INTERVAL);
  </script>

  <!-- üî• Clash of Clans Footer -->
  <footer class="coc-footer">
    <div class="coc-bg"></div>

    <div class="coc-footer-content">
      <img 
        src="https://i.ibb.co/J3wK9nQ/clash-of-clans-logo.png"
        class="coc-logo-left"
      >

      <!-- üîÅ Replace URL with your real transparent logo later -->
      <img 
        src="https://i.ibb.co/6rPp8kY/your-transparent-logo.png"
        class="clan-logo-center"
      >

      <div class="clan-name">CHECKMATES</div>
    </div>

    <div class="footer-text">
      ¬© 2025 CHECKMATES | Clash of Clans War Stats
    </div>
  </footer>

</body>
</html>
